class Uppromote{constructor(a="production",b=!0){this.env=a,this.host={dev:"https://secomapp-affiliate.test",test:"https://af-test.uppromote.com",production:"https://track.uppromote.com"}[a]||"https://track.uppromote.com",this.cdnHost={dev:"https://secomapp-affiliate.test",test:"https://af-test.uppromote.com",production:"https://d1639lhkj5l89m.cloudfront.net"}[a]||"https://d1639lhkj5l89m.cloudfront.net",this.cdnS3Host={dev:"https://secomapp-affiliate.test",test:"https://af-test.uppromote.com",production:"https://cdn.uppromote.com"}[a]||"https://cdn.uppromote.com",this.cache=b}init(){this.processOnLoadPage(),this.uppromoteLog("Running...")}assetS3(a=""){let b=this.cdnS3Host;return a.startsWith("http")?a:("production"!==this.env&&(b=`${b}/storage`),a=a.replace("//","/"),a=a.startsWith("/")?a.slice(1,a.length):a,`${b}/${a}`)}renderElm(a="div",b,c={},d){const e=document.createElement(a);return b&&(Array.isArray(b)?b.map(a=>e.classList.add(a)):b&&0!==b.length&&e.classList.add(b)),Object.keys(c).forEach(a=>e.setAttribute(a,c[a])),d&&(e.innerHTML=d),e}async fetchAndGetContent(a="",b="GET",c={}){if(c.shopify_domain=this.getShopDomain(),["GET","HEAD"].includes(b)){a=new URL(a);const b=new URLSearchParams(c),d=a.searchParams,e=new URLSearchParams({...Object.fromEntries(b),...Object.fromEntries(d)});a=`${a.origin}${a.pathname}?${e.toString()}`;const f=await fetch(a);return(await f.json())||null}else{const d=new FormData;Object.keys(c).forEach(a=>d.append(a,c[a]));const e=await fetch(a,{method:b,headers:{},body:d});return(await e.json())||null}}setCookie(a,b,c){const e=new Date;e.setTime(e.getTime()+1e3*(60*(60*(24*c))));let d="expires="+e.toUTCString();document.cookie=a+"="+b+";"+d+";path=/"}getCookie(a){let b=a+"=",c=decodeURIComponent(document.cookie),d=c.split(";");for(let e,c=0;c<d.length;c++){for(e=d[c];" "===e.charAt(0);)e=e.substring(1);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return""}mustPostClickTracking(a){if(!a)return!0;const b=new Date().getTime();return b-a>60000}checkResponseFromServer(){if("false"===localStorage.getItem("scaaf_received")){const a=this.getCookie("scaaf_aid")||localStorage.getItem("scaaf_aid");if(!a)return;this.postClickTracking({aid:a,tid:localStorage.getItem("scaaf_tid"),hc:localStorage.getItem("scaaf_hc"),s:this.getShopName(),ug:navigator.userAgent},null,()=>{uppromote.uppromoteLog("ReTracking success!")})}}parseQueryStringToObject(a=""){try{const b=new URLSearchParams(a),c=b.entries(),d={};for(const[a,b]of c)d[a]=b;return d}catch(a){return{}}}getShopDomain(){try{return Shopify?Shopify.shop:""}catch(a){return console.error("Uppromote: getShopName() - Error when get shopify domain"),""}}getShopName(){return this.getShopDomain().replace(".myshopify.com","")}getShopifyCheckoutObject(){return Shopify&&Shopify.checkout?Shopify.checkout:null}getShopifyCheckoutInformationObject(){return Shopify&&Shopify.Checkout?Shopify.Checkout:null}copyToClipboard(a,b){a.focus(),a.select(),navigator.clipboard.writeText(a.value).then(b)}applyDiscountCode(a){const b=this.renderElm("iframe","sca_d-none",{src:`/discount/${a}`});b.style.display="none",document.body.append(b)}getMessageBarSetting(){return"undefined"==typeof SCAAFMessageBar?null:SCAAFMessageBar}initFbPixel(){if("undefined"==typeof disableUppromoteFacebookPixel){const a=this.renderElm("script","sca_aff_fb_pixel_init");a.textContent=`!function(a,c,b,d,e,f,g){a.fbq||(e=a.fbq=function(){e.callMethod?e.callMethod.apply(e,arguments):e.queue.push(arguments)},!a._fbq&&(a._fbq=e),e.push=e,e.loaded=!0,e.version="2.0",e.queue=[],f=c.createElement(b),f.async=!0,f.src=d,g=c.getElementsByTagName(b)[0],g.parentNode.insertBefore(f,g))}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");`,document.head.append(a)}}getCouponCode(a,b){const c=`${this.host}/api/get_coupon`,d=a||this.getCookie("scaaf_aid");d&&this.fetchAndGetContent(c,"GET",{aid:d}).then(a=>{"ok"===a.status?(uppromote.applyDiscountCode(a.coupon),setTimeout(()=>{b&&(window.location.href=`${b}&discount=${a.coupon}`)},200)):b&&(window.location.href=b)}).catch(()=>{b&&(window.location.href=b)})}trackFbPixel(a){if("undefined"!=typeof disableUppromoteFacebookPixel)return;const b=`${this.host}/api/get_fb_pixel`,c={aff_id:a||this.getCookie("scaaf_aid")||localStorage.getItem("scaaf_aid"),shop:`${this.getShopDomain()}`},d=function(a){const b=uppromote.getShopifyCheckoutObject(),c=uppromote.getShopifyCheckoutInformationObject();fbq("init",a),fbq("trackSingle",a,"PageView"),b&&fbq("trackSingle",a,"Purchase",{value:b.total_price,currency:b.currency}),c&&"contact_information"===c.step&&fbq("trackSingle",a,"InitiateCheckout",{currency:b.currency,value:b.estimatedPrice}),document.location.pathname.startsWith("/cart")&&fbq("trackSingle",a,"AddToCart")};c.aff_id&&this.fetchAndGetContent(b,"GET",c).then(a=>{"ok"===a.status&&d(a.pixel)}).catch(a=>{console.error("Uppromote: trackFbPixel() - Error when fetch Fb pixel"),console.error(a)})}appendAffiliateIdToRegisterForm(a=null){const b=window.location.pathname.split("/")[2]||"";if("register"===b&&(a=a||this.getCookie("scaaf_aid")||localStorage.getItem("scaaf_aid"),!!a)){const b=document.querySelector(`form[method="post"][action*="account"]`);if(b){const c=this.renderElm("input",null,{type:"hidden",name:"customer[note][affiliate_id]",value:a});b.append(c)}}}getPostPurchasePopupSetting(){const a=`${this.host}/api/purchase_popup/setting`,b=this.getShopifyCheckoutObject();if(b&&b.email){const c={email:b.email,shop:this.getShopDomain()};this.fetchAndGetContent(a,"GET",c).then(a=>{"ok"===a.status&&uppromote.renderPostPurchasePopup(a)})}}renderPostPurchasePopup(a){if(this.getCookie("sca_p_p_show_once")&&1===a.settings.show_only_once)return;1===a.settings.show_only_once&&this.setCookie("sca_p_p_show_once",1,360);const b=a.settings,c=b.design,d=b.promotion_method,e=b.custom_css,f=a.customize,g=`${this.cdnHost}/css/script_tag/script_affiliate.css`,h=this.renderElm("link",null,{href:`${g}${this.cache?"":`?v=${new Date().getTime()}`}`,rel:"stylesheet"}),i=this.renderElm("style",null,{},e);document.head.append(h,i);const j=this.renderElm("div","sca_purchase_popup_modal_container"),k=this.renderElm("div",["sml","is-open"],{id:"modal-1","aria-hidden":"false"}),l=this.renderElm("div","sca_modal_overlay",{id:"sca_modal_overlay",tabindex:"-1","data-micromodal-close":""}),m=this.renderElm("div","sca_modal_container",{id:"modal_container",role:"dialog","aria-modal":"true","aria-labelledby":"modal-1-title"}),n=this.renderElm("button",["sca_modal_close","x-btn"],{"aria-label":"Close modal","data-micromodal-close":"",id:"sca_post_purchase_popup_close_button"},"x"),o=this.renderElm("div",null,{id:"sca_popup"}),p=this.renderElm("div","sca_modal_image",{alt:"Post purchase popup"});let q="none"===c.header_image?this.cdnHost+`/img/default_popup.jpg`:this.assetS3(c.header_image);"/img/default_popup.jpg"===c.header_image&&(q=this.cdnHost+"/img/default_popup.jpg"),p.style.backgroundImage=`url(${q})`,p.style.height=`${c.image_height}px`;const r=this.renderElm("div",null,{id:"sca_main"}),s=this.renderElm("div",null,{id:"sca_content"}),t=this.renderElm("div",null,{id:"sca_title"},c.title);t.style.color=c.title_color;const u=this.renderElm("div",null,{id:"sca_subtitle"},2===d?c.sub_title_coupon:c.sub_title);let v,w;if(f){v=this.renderElm("div","scaaff_require_term"),w=this.renderElm("input",null,{type:"checkbox",id:"confirm-term",name:"confirm-term"});const a=this.renderElm("label",null,{for:"confirm-term"},`I agree with <a href="${f.term}" target="_blank">Terms and Conditions</a>`);v.append(w,a)}const x=this.renderElm("div","sca_result_wrapper",{id:"sca_result_wrapper"}),y=2===d?c.button_text_coupon:c.button_text,z=this.renderElm("button",null,{id:"sca_reg_mode_manual_btn","data-origin-text":y},y);z.style.cursor=f?"not-allowed":"pointer",z.style.backgroundColor=c.button_background,z.style.color=c.button_text_color,z.style.borderRadius=`${c.button_border_radius}px`;const A=this.renderElm("div","sca_share_container",{id:"sca_share"}),B=function(){k.setAttribute("aria-hidden","true"),setTimeout(()=>{j.style.display="none"},300)},C=function(){f&&(z.style.cursor=w.checked?"pointer":"not-allowed",z.disabled=!w.checked)},D=function(){f?w.checked&&uppromote.postRegisterAffiliatePostPurchasePopup():uppromote.postRegisterAffiliatePostPurchasePopup()};z.append(A),x.append(z),s.append(t,u),v&&s.append(v),s.append(x),r.append(s),o.append(p,r,A),m.append(n,o),l.append(m),k.append(l),j.append(k),document.body.append(j),n.addEventListener("click",B),1===b.close_background_click&&document.addEventListener("click",function(a){a.target===l&&B()}),v&&w&&w.addEventListener("change",C),z.addEventListener("click",D)}postRegisterAffiliatePostPurchasePopup(){const a=document.getElementById("sca_reg_mode_manual_btn"),b=document.getElementById("sca_result_wrapper");if(!a&&!b)return;const c=function(b=!0){a.disabled=b,a.style.cursor=b?"not-allowed":"pointer",a.textContent=b?"Loading...":a.dataset.originText},d=this.getShopifyCheckoutObject();if(!d||!d.email)return;const e=function(a){const c=uppromote.renderElm("div","result_wrapper"),d=uppromote.renderElm("div","input-link-wrapper"),e=uppromote.renderElm("input","sca_ip",{id:"sca_referral_link_ip",type:"text",value:a.coupon_code||a.referral_link}),f=a.coupon_code?"Copy coupon":"Copy link",g=uppromote.renderElm("button",["sca_bt","sca_btn_copy"],{id:"sca_popup_copy_btn"},f);d.append(e),c.append(d,g),b.innerHTML="",b.append(c),g.addEventListener("click",()=>{uppromote.copyToClipboard(e,()=>{g.textContent="Copied!",setTimeout(()=>{g.textContent=f},1e3)})});const h={facebook:{title:"Share on Facebook",img:`${uppromote.cdnHost}/img/facebook.svg`,shareUrl:"https://www.facebook.com/sharer.php?u="},twitter:{title:"Share on Twitter",img:`${uppromote.cdnHost}/img/twitter.svg`,shareUrl:"https://twitter.com/intent/tweet?url="},pinterest:{title:"Share on Pinterest",img:`${uppromote.cdnHost}/img/pinterest.svg`,shareUrl:"https://pinterest.com/pin/create/link/?url="},linkedin:{title:"Share on LinkedIn",img:`${uppromote.cdnHost}/img/linkedin.svg`,shareUrl:"https://www.linkedin.com/shareArticle?mini=true&url="}},i=document.getElementById("sca_share");for(const b in h){const c=uppromote.renderElm("a",null,{target:"_blank",title:h[b].title,href:`${h[b].shareUrl}${a.referral_link}`}),d=uppromote.renderElm("img",null,{alt:h[b].title,src:h[b].img});c.append(d),i.append(c)}i.style.display="block"},f=function(a){const b=a.message,d=document.querySelector("#sca_popup #sca_content"),e=d.querySelector("#sca_subtitle");let f=d.querySelector("#sca_post_purchase_error");f&&f.remove(),f=uppromote.renderElm("p","sca_post_purchase_error",{id:"sca_post_purchase_error"},b),b&&d&&e.after(f),c(!1)},g={email:d.email,first_name:d.billing_address.first_name,last_name:d.billing_address.last_name,shop:this.getShopDomain()},h=this.getCookie("scaaf_aid")||localStorage.getItem("scaaf_aid"),i=d.discount?d.discount.code:null;h&&(g.affiliate_id=h),i&&(g.coupon=i),c(),this.fetchAndGetContent(`${this.host}/api/post_affiliate_purchase`,"POST",g).then(a=>{"ok"===a.status?e(a):f(a)})}renderMessageBar(){if(parseInt(scaAffCustomerRefer.getCookie("scaaf_is_program_customer")))return;const a=document.querySelector(".scaaf-message-bar");a&&a.remove();const b=this.getMessageBarSetting();if(!b)return;const c={name:this.getCookie("scaaf_afn")||"",first_name:this.getCookie("scaaf_affn")||"",company:this.getCookie("scaaf_afc")||"",personal_detail:this.getCookie("scaaf_pd")||""},d=["Arial","Helvetica+Neue","Courier+New","Times+New+Roman","Comic+Sans+MS","Impact"],e=a=>{const b=this.renderElm("link",null,{href:`https://fonts.googleapis.com/css?family=${a}`,rel:"stylesheet",type:"text/css"});document.head.append(b)},f=()=>{if(!b.referral_content)return;const a=b.referral_font.replace(/\+/g," ").split(":");e(b.referral_font);const d=this.renderElm("div","scaaf-message-bar"),f=this.renderElm("p","scaaf-message-bar-content");d.style.backgroundColor=b.referral_background_color,f.style.color=b.referral_text_color,f.style.fontSize=b.referral_font_size+"px",f.style.fontFamily=`"${a[0]}", sans-serif`,f.innerHTML=b.referral_content.replace("{affiliate_name}",c.name).replace("{company}",c.company).replace("{affiliate_firstname}",c.first_name).replace("{personal_detail}",c.personal_detail),d.append(f),document.body.prepend(d)},g=()=>{if(!b.not_referral_content)return;const a=b.not_referral_font.replace(/\+/g," ").split(":");-1===d.indexOf(b.not_referral_font)&&e(b.not_referral_font);const c=this.renderElm("div","scaaf-message-bar"),f=this.renderElm("p","scaaf-message-bar-content");c.style.backgroundColor=b.not_referral_background_color,f.style.color=b.not_referral_text_color,f.style.fontSize=b.not_referral_font_size+"px",f.style.fontFamily=`"${a[0]}", sans-serif`,f.innerHTML=b.not_referral_content,c.append(f),document.body.prepend(c)};if((()=>{let a=`${this.cdnHost}/css/script_tag/script_affiliate_message_bar.css`;const b=this.renderElm("link",null,{href:this.cache?a:a+`?v=${new Date().getTime()}`,rel:"stylesheet",type:"text/css"});document.head.append(b)})(),1===b.referral_enable){if(c.name)return void f();1===b.not_referral_enable&&g()}}postClickTracking(a,b,c){localStorage.getItem("scaaf_sca_source_secomus")&&(a.sca_source=localStorage.getItem("scaaf_sca_source_secomus")),this.fetchAndGetContent(`${this.host}/api/click_tracking`,"POST",a).then(d=>"ok"===d.status?(this.uppromoteLog(`Tracking affiliate id ${a.aid}`),this.setLocalTrackingReceivedVariables(d),this.getCouponCode(),scaAffCustomerRefer.setCustomerReferralState(1,d.program_id),c&&c(d),void this.runCustomizePostClickTrackingCallback(d)):void(b&&clearInterval(b),scaAffCustomerRefer.setCustomerReferralState(0,null),c&&c(d))).catch(a=>{b&&clearInterval(b),scaAffCustomerRefer.setCustomerReferralState(0,null),c&&c(a),console.warn(a)})}postCheckoutToken(){const a=this.getShopifyCheckoutObject(),b=this.getShopifyCheckoutInformationObject();if(b&&b.token&&a){const c={aid:localStorage.getItem("scaaf_aid"),ct_tk:b.token,s:this.getShopName(),hc:localStorage.getItem("scaaf_hc"),order_id:a.order_id};localStorage.getItem("scaaf_sca_source_secomus")&&(c.sca_source=localStorage.getItem("scaaf_sca_source_secomus")),this.fetchAndGetContent(`${this.host}/api/ct_tk`,"POST",c).then(()=>{}).catch(a=>{console.error(a)})}}postCartToken(a,b){a.ug=navigator.userAgent,localStorage.getItem("scaaf_sca_source_secomus")&&(a.sca_source=localStorage.getItem("scaaf_sca_source_secomus")),this.fetchAndGetContent(`${this.host}/api/ctk`,"POST",a).then(c=>{"ok"===c.status&&(this.setCookie("scaaf_tid",c.tid,360),localStorage.setItem("scaaf_tid",c.tid),localStorage.setItem("scaaf_ctk",a.ctk),this.setCookie("scaaf_ctk",a.ctk,360),localStorage.setItem("scaaf_received","true")),clearInterval(b)}).catch(a=>{clearInterval(b),console.error(a)})}processOnLoadPage(){const a=this.parseQueryStringToObject(window.location.search.substring(1));if(a.sca_ref){const b=a.sca_ref.split("."),c={aid:b[0],hc:b[1],s:this.getShopName(),tid:localStorage.getItem("scaaf_tid"),ug:navigator.userAgent},d=localStorage.getItem("scaaf_c_c"),e=new Date().getTime(),f=this.mustPostClickTracking(d);f&&this.setLocalTrackingVariables(c.aid,!1,c.hc,e,a.sca_source),f?this.postClickTracking(c,null):this.renderMessageBar(),a.sca_rib&&(this.getCookie("scaaf_aid")?this.getCouponCode(c.aid,a.sca_rib):window.location.href=a.sca_rib)}else this.checkResponseFromServer(),this.renderMessageBar(),this.getCouponCode();this.intervalCheckCartToken(),this.postCheckoutToken(),this.appendAffiliateIdToRegisterForm(),this.getPostPurchasePopupSetting(),this.initFbPixel(),setTimeout(()=>uppromote.trackFbPixel(),200)}setLocalTrackingVariables(a,b=!1,c,d,e){localStorage.setItem("scaaf_aid",a),localStorage.setItem("scaaf_received",b?"true":"false"),localStorage.setItem("scaaf_hc",c),localStorage.setItem("scaaf_c_c",d),this.setCookie("scaaf_aid",a,360),this.setCookie("scaaf_c_c",d,360),e&&(localStorage.setItem("scaaf_sca_source_secomus",e||""),this.setCookie("scaaf_sca_source_secomus",e||"",360))}setLocalTrackingReceivedVariables(a={}){localStorage.setItem("scaaf_received","true"),localStorage.setItem("scaaf_tid",a.tid),localStorage.setItem("scaaf_ep",(1e3*a.ep).toString()),this.setCookie("scaaf_tid",a.tid,360),this.setCookie("scaaf_ep",1e3*a.ep,360),this.setCookie("scaaf_afn",a.afd.affiliate_name||"",a.afcookie),this.setCookie("scaaf_afc",a.afd.company||"",a.afcookie),this.setCookie("scaaf_affn",a.afd.affiliate_firstname||"",a.afcookie),this.setCookie("scaaf_pd",a.afd.personal_detail||"",a.afcookie)}intervalCheckCartToken(){const a=setInterval(()=>{const b=localStorage.getItem("scaaf_ctk"),c=this.getCookie("cart");if(c){const d=localStorage.getItem("scaaf_tid"),e=localStorage.getItem("scaaf_aid");if(d&&e){const d=localStorage.getItem("scaaf_ep");if(d&&d<new Date().getTime())return void clearInterval(a);if(b!==c){const b=this.getShopifyCheckoutObject();if(b)return void clearInterval(a);this.postCartToken({aid:localStorage.getItem("scaaf_aid"),tid:localStorage.getItem("scaaf_tid"),ctk:c,s:this.getShopName()},a)}}"false"===localStorage.getItem("scaaf_received")&&this.postClickTracking({aid:localStorage.getItem("scaaf_aid"),tid:localStorage.getItem("scaaf_tid"),hc:localStorage.getItem("scaaf_hc"),s:this.getShopName(),ug:navigator.userAgent},a)}},1e3)}runCustomizePostClickTrackingCallback(a){if("function"==typeof scaAffClickTrackingCallback)try{scaAffClickTrackingCallback(a)}catch(a){console.log(a)}}uppromoteLog(a){console.log(`%c ► Uppromote Affiliate Marketing: (${a})`,"background-color: #FF4141; color: #fff; padding: 5px;")}}class SCAAFFCustomerRefer{constructor(a="production"){this.env=a,this.host={dev:"https://secomapp-affiliate.test",test:"https://af-test.uppromote.com",production:"https://track.uppromote.com"}[a]||"https://track.uppromote.com",this.setting=null,this.referContainer=null,this.referIcon=null,this.closeButtonIcon=null,this.inviteContainer=null,this.inviteContentContainer=null,this.errorText=null,this.closeButton=null,this.inviteEmailInput=null,this.getInviteLinkButton=null,this.closeShopNowButton=null,this.shopNowContainer=null,this.shopNowOverlayContainer=null,this.uiComponents={}}init(){const a=setInterval(()=>{"undefined"!=typeof SCAAFFCustomerReferSetting&&(clearInterval(a),uppromote.uppromoteLog("Customer referral running"),scaAffCustomerRefer.setting=SCAAFFCustomerReferSetting,scaAffCustomerRefer.setting.program.active&&(this.renderReferCustomer(),this.addEventListener(),this.checkRegisterStatus()))},500);setTimeout(()=>{clearInterval(a)},1e4)}addEventListener(){scaAffCustomerRefer.referContainer&&(scaAffCustomerRefer.referIcon.addEventListener("click",scaAffCustomerRefer.onReferButtonClicked),scaAffCustomerRefer.closeButton.addEventListener("click",scaAffCustomerRefer.onReferButtonClicked),scaAffCustomerRefer.getInviteLinkButton.addEventListener("click",scaAffCustomerRefer.submitRegister),scaAffCustomerRefer.closeButtonIcon.addEventListener("click",scaAffCustomerRefer.onCloseIconButton))}addShopNowPopupEventListener(){scaAffCustomerRefer.closeShopNowButton&&(scaAffCustomerRefer.closeShopNowButton.addEventListener("click",function(a){scaAffCustomerRefer.onCloseShopNowButtonClicked(a)}),scaAffCustomerRefer.shopNowOverlayContainer.addEventListener("click",function(a){scaAffCustomerRefer.onCloseShopNowButtonClicked(a)}),scaAffCustomerRefer.uiComponents.shopNowButton.addEventListener("click",function(a){scaAffCustomerRefer.onCloseShopNowButtonClicked(a)}))}checkRegisterStatus(){const a=scaAffCustomerRefer.getCookie("scaaf_refer_customer_link");a&&(scaAffCustomerRefer.applyInviteLink(a),scaAffCustomerRefer.setRegisterState(a))}renderReferCustomer(){if(this.closedInviteIcon())return;const a=scaAffCustomerRefer.renderCustomerReferContainer(),b=scaAffCustomerRefer.renderReferIcon(),c=scaAffCustomerRefer.renderCloseInviteButton(),d=scaAffCustomerRefer.renderInviteContainer(),e=scaAffCustomerRefer.renderCloseButton(),f=scaAffCustomerRefer.renderInviteContentContainer(),g=scaAffCustomerRefer.renderInviteHeader(),h=scaAffCustomerRefer.renderInviteContent(),i=scaAffCustomerRefer.renderInviteInputContainer(),j=scaAffCustomerRefer.renderInviteInput(),k=scaAffCustomerRefer.renderInviteInputAddon(),l=scaAffCustomerRefer.renderErrorContainer();b.append(c),i.append(k,j),f.append(g,h,i,l),d.append(e,f),a.append(d,b),document.body.append(a)}renderShopNowPopup(){const a=this.renderShopNowOverlay(),b=this.renderShopNowContainer(),c=this.renderCloseShopNowButton(),d=this.renderShopNowHeader(),e=this.renderShopNowContent(),f=this.renderShopNowButton();scaAffCustomerRefer.uiComponents.shopNowButton=f,b.append(c,d,e,f),a.append(b),document.body.append(a)}onReferButtonClicked(){let a="fadeInUp",b="fadeOutDown";const c=scaAffCustomerRefer.referContainer.dataset.webPosition;"none"===getComputedStyle(scaAffCustomerRefer.inviteContainer).display?(c.includes("-bottom")&&(a="fadeInUp"),(c.includes("-center")||c.includes("-top"))&&(a="fadeInDown"),scaAffCustomerRefer.inviteContainer.style.animationName=a,setTimeout(()=>{scaAffCustomerRefer.inviteContainer.style.display="block"},100)):(c.includes("-bottom")&&(b="fadeOutDown"),(c.includes("-center")||c.includes("-top"))&&(b="fadeOutUp"),scaAffCustomerRefer.inviteContainer.style.animationName=b,setTimeout(()=>{scaAffCustomerRefer.inviteContainer.style.display="none"},500))}onCloseShopNowButtonClicked(a){const b=a.target.classList;(b.contains("sca_aff_customer_refer_shop_now_overlay")||b.contains("sca_aff_customer_refer_close_shop_now_button")||b.contains("sca_aff_customer_refer_shop_now_button"))&&(scaAffCustomerRefer.shopNowContainer.style.animationName="fadeOutUp",scaAffCustomerRefer.shopNowOverlayContainer.style.animationName="fadeOut",setTimeout(()=>{scaAffCustomerRefer.shopNowOverlayContainer.style.display="none"},500))}submitRegister(){if(this.hasAttribute("data-created-affiliate"))scaAffCustomerRefer.copyInviteLink();else{const a=scaAffCustomerRefer.inviteEmailInput.value;if(!scaAffCustomerRefer.isValidEmail(a))return scaAffCustomerRefer.errorText.textContent="Please enter a valid email address",void(scaAffCustomerRefer.errorText.style.display="block");scaAffCustomerRefer.setRegisteringStateButton(),scaAffCustomerRefer.postRegister(a)}}onCloseIconButton(){scaAffCustomerRefer.referContainer.remove(),sessionStorage.setItem("closed_refer_customer","1")}postRegister(a){const b=scaAffCustomerRefer.setting.program.shop;uppromote.fetchAndGetContent(`${scaAffCustomerRefer.host}/api/refer-customer/register`,"POST",{email:a,shop:b}).then(a=>{scaAffCustomerRefer.errorText.style.display="none",a.error?(scaAffCustomerRefer.errorText.textContent=a.error,scaAffCustomerRefer.errorText.style.display="block"):(scaAffCustomerRefer.applyInviteLink(a.data),scaAffCustomerRefer.setRegisterState(a.data)),scaAffCustomerRefer.setRegisteringStateButton(!1)})}processCustomerReferLink(){scaAffCustomerRefer.setting.program.active&&scaAffCustomerRefer.isCustomerReferLink()&&(this.displayedShopNowPopup()||(scaAffCustomerRefer.renderShopNowPopup(),scaAffCustomerRefer.addShopNowPopupEventListener(),scaAffCustomerRefer.applyDiscountCode()))}closedInviteIcon(){return!!sessionStorage.getItem("closed_refer_customer")}displayedShopNowPopup(){const a=document.querySelector(`.sca_aff_customer_refer_shop_now_overlay`);return!!a}isValidEmail(a){return /^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,7})+$/.test(a)}setRegisterState(a){scaAffCustomerRefer.setCookie("scaaf_refer_customer_link",a,365)}setCookie(a,b,c){const e=new Date;e.setTime(e.getTime()+1e3*(60*(60*(24*c))));let d="expires="+e.toUTCString();document.cookie=a+"="+b+";"+d+";path=/"}getCookie(a){let b=a+"=",c=decodeURIComponent(document.cookie),d=c.split(";");for(let e,c=0;c<d.length;c++){for(e=d[c];" "===e.charAt(0);)e=e.substring(1);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return""}isCustomerReferLink(){try{const a=window.location.search,b=new URLSearchParams(a);let c=!1;return b.get("sca_ref")&&b.get("sca_crp")&&parseInt(atob(this.setting.program.program))===parseInt(atob(b.get("sca_crp")))&&(c=!0),c}catch(a){return console.error("Cant base64 decode customer refer program id"),!1}}setCustomerReferralState(a,b){scaAffCustomerRefer.waitForSetting(function(){try{const c=parseInt(b),d=parseInt(atob(scaAffCustomerRefer.setting.program.program));c===d?(a&&scaAffCustomerRefer.processCustomerReferLink(),scaAffCustomerRefer.setCookie("scaaf_is_program_customer",1,30),uppromote.renderMessageBar()):(scaAffCustomerRefer.setCookie("scaaf_is_program_customer",0,30),uppromote.renderMessageBar())}catch(a){console.error(a)}},function(){scaAffCustomerRefer.setCookie("scaaf_is_program_customer",0,30),uppromote.renderMessageBar()})}waitForSetting(a,b){let c=!1;const d=function(){clearInterval(e),!c&&b&&b()},e=setInterval(function(){scaAffCustomerRefer.setting&&(clearInterval(e),a(),c=!0)},500);setTimeout(d,1e3)}setRegisteringStateButton(a=!0){a?(scaAffCustomerRefer.getInviteLinkButton.setAttribute("disabled",""),scaAffCustomerRefer.getInviteLinkButton.style.cursor="wait",scaAffCustomerRefer.inviteEmailInput.setAttribute("disabled","")):(scaAffCustomerRefer.getInviteLinkButton.removeAttribute("disabled"),scaAffCustomerRefer.getInviteLinkButton.style.cursor="pointer",scaAffCustomerRefer.inviteEmailInput.removeAttribute("disabled"))}applyInviteLink(a){scaAffCustomerRefer.getInviteLinkButton.removeAttribute("disabled"),scaAffCustomerRefer.getInviteLinkButton.setAttribute("data-created-affiliate","true"),scaAffCustomerRefer.getInviteLinkButton.textContent=scaAffCustomerRefer.setting.design.refer_customer_invite.button_copy_invite,scaAffCustomerRefer.inviteEmailInput.type="text",scaAffCustomerRefer.inviteEmailInput.value=a,scaAffCustomerRefer.inviteEmailInput.setAttribute("readonly",""),scaAffCustomerRefer.inviteContentContainer.append(this.renderShareContainer(a))}copyInviteLink(){scaAffCustomerRefer.inviteEmailInput.focus(),scaAffCustomerRefer.inviteEmailInput.select(),navigator.clipboard.writeText(scaAffCustomerRefer.inviteEmailInput.value).then(()=>{scaAffCustomerRefer.getInviteLinkButton.textContent="Copied!",setTimeout(()=>{scaAffCustomerRefer.getInviteLinkButton.textContent=scaAffCustomerRefer.setting.design.refer_customer_invite.button_copy_invite},1e3)})}renderElm(a="div",b,c={}){const d=document.createElement(a);return b&&(Array.isArray(b)?b.map(a=>d.classList.add(a)):b&&0!==b.length&&d.classList.add(b)),Object.keys(c).forEach(a=>d.setAttribute(a,c[a])),d}renderCustomerReferContainer(){return this.referContainer=scaAffCustomerRefer.renderElm("div","sca_aff_customer_refer_container",{"data-web-position":scaAffCustomerRefer.setting.design.refer_customer_button.web_position,"data-mobile-position":scaAffCustomerRefer.setting.design.refer_customer_button.mobile_position}),this.referContainer}renderReferIcon(){const a=scaAffCustomerRefer.renderElm("button","sca_aff_customer_refer_button");scaAffCustomerRefer.referIcon=a;const b=scaAffCustomerRefer.renderElm("img",["sca_aff_customer_refer_icon"],{src:"https://cdn.uppromote.com/storage/feature-banner/gift.svg",alt:"Customer Referral"}),c=scaAffCustomerRefer.renderElm("span");return c.textContent=scaAffCustomerRefer.setting.design.refer_customer_button.refer_button_text,a.style.backgroundColor=scaAffCustomerRefer.setting.design.refer_customer_button.refer_background_color,a.style.color=scaAffCustomerRefer.setting.design.refer_customer_button.refer_text_color,a.prepend(b,c),a}renderCloseInviteButton(){const a=scaAffCustomerRefer.renderElm("span","sca_aff_customer_refer_close_icon_button");return this.closeButtonIcon=a,a.innerHTML="&times;",a}renderInviteContainer(){const a=scaAffCustomerRefer.renderElm("div","sca_aff_customer_refer_invite_container");return scaAffCustomerRefer.inviteContainer=a,a}renderCloseButton(){const a=scaAffCustomerRefer.renderElm("button","sca_aff_customer_refer_close_button",{type:"button"});return a.innerHTML="&times;",scaAffCustomerRefer.closeButton=a,a}renderInviteContentContainer(){const a=scaAffCustomerRefer.renderElm("div","sca_aff_customer_refer_invite_contents");return this.inviteContentContainer=a,a}renderInviteHeader(){const a=scaAffCustomerRefer.renderElm("h1","sca_aff_customer_refer_invite_header");return a.textContent=scaAffCustomerRefer.setting.design.refer_customer_invite.popup_header,a}renderInviteContent(){const a=scaAffCustomerRefer.renderElm("div","sca_aff_customer_refer_invite_content");return a.textContent=scaAffCustomerRefer.setting.design.refer_customer_invite.popup_description,a}renderInviteInputContainer(){return scaAffCustomerRefer.renderElm("div","sca_aff_custom_invite_inputs")}renderInviteInputAddon(){const a=scaAffCustomerRefer.renderElm("input","sca_aff_custom_invite_input",{type:"email",name:"sca_customer_refer_email",id:"sca_customer_refer_email",placeholder:"Your email address"});return scaAffCustomerRefer.inviteEmailInput=a,a}renderErrorContainer(){const a=this.renderElm("p","sca_aff_customer_invite_error");return this.errorText=a,a}renderShareContainer(a){a=encodeURIComponent(a);const b=this.renderElm("div","sca_aff_customer_invite_share_container"),c=this.renderElm("a",null,{href:`https://facebook.com/sharer/sharer.php?u=${a}`,target:"_blank"}),d=this.renderElm("img",null,{src:"https://cdn.uppromote.com/storage/uploads/icons/facebook.svg",alt:"facebook"}),e=this.renderElm("a",null,{href:`https://twitter.com/intent/tweet/?text=&url=${a}`,target:"_blank"}),f=this.renderElm("img",null,{src:"https://cdn.uppromote.com/storage/uploads/icons/twitter.svg",alt:"twitter"}),g=this.renderElm("a",null,{href:`https://pinterest.com/pin/create/button/?url=${a}`,target:"_blank"}),h=this.renderElm("img",null,{src:"https://cdn.uppromote.com/storage/uploads/icons/pinterest.svg",alt:"pinterest"}),i=this.renderElm("a",null,{href:`https://www.linkedin.com/shareArticle?mini=true&url=${a}&title=&summary=&source=${a}`,target:"_blank"}),j=this.renderElm("img",null,{src:"https://cdn.uppromote.com/storage/uploads/icons/linkedin.svg",alt:"linkedin"}),k=this.renderElm("a",null,{href:`https://reddit.com/submit/?url=${a}`,target:"_blank"}),l=this.renderElm("img",null,{src:"https://cdn.uppromote.com/storage/uploads/icons/reddit.svg",alt:"reddit"}),m=this.renderElm("a",null,{href:`mailto:?subject=&body=${a}`,target:"_blank"}),n=this.renderElm("img",null,{src:"https://cdn.uppromote.com/storage/uploads/icons/mail.svg",alt:"mail"});return c.append(d),e.append(f),g.append(h),i.append(j),k.append(l),m.append(n),b.append(c,e,g,i,k,m),b}renderInviteInput(){const a=scaAffCustomerRefer.renderElm("button","sca_aff_customer_refer_invite_button");return a.textContent=scaAffCustomerRefer.setting.design.refer_customer_invite.button_text_get_invite,a.style.backgroundColor=scaAffCustomerRefer.setting.design.refer_customer_invite.popup_background_color,a.style.color=scaAffCustomerRefer.setting.design.refer_customer_invite.popup_text_color,scaAffCustomerRefer.getInviteLinkButton=a,a}applyDiscountCode(){if("none"!==scaAffCustomerRefer.setting.program.incentive.type){const a=this.renderElm("iframe","sca_aff_customer_refer_discount_iframe");a.style.display="none";const b=scaAffCustomerRefer.setting.program.incentive.coupon;a.src=`/discount/${b}`,document.body.append(a)}}renderShopNowOverlay(){const a=this.renderElm("div","sca_aff_customer_refer_shop_now_overlay");return this.shopNowOverlayContainer=a,a}renderShopNowContainer(){const a=this.renderElm("div","sca_aff_customer_refer_shop_now_container");return this.shopNowContainer=a,a}renderCloseShopNowButton(){const a=scaAffCustomerRefer.renderElm("button","sca_aff_customer_refer_close_shop_now_button",{type:"button"});return a.innerHTML="&times;",scaAffCustomerRefer.closeShopNowButton=a,a}renderShopNowHeader(){const a=scaAffCustomerRefer.renderElm("h2","sca_aff_customer_refer_shop_now_header");return a.textContent=scaAffCustomerRefer.setting.design.refer_customer_incentive_popup.shop_header,a}renderShopNowContent(){const a=scaAffCustomerRefer.renderElm("div","sca_aff_customer_refer_shop_now_content");return a.textContent=scaAffCustomerRefer.setting.design.refer_customer_incentive_popup.shop_description,a}renderShopNowButton(){const a=scaAffCustomerRefer.renderElm("a","sca_aff_customer_refer_shop_now_button",{href:`#`});return a.innerHTML=scaAffCustomerRefer.setting.design.refer_customer_incentive_popup.shop_button_text,a.style.backgroundColor=scaAffCustomerRefer.setting.design.refer_customer_incentive_popup.shop_background_color,a.style.color=scaAffCustomerRefer.setting.design.refer_customer_incentive_popup.shop_text_color,scaAffCustomerRefer.shopNowButton=a,a}}const uppromote=new Uppromote("production"),scaAffCustomerRefer=new SCAAFFCustomerRefer("production");uppromote.init(),scaAffCustomerRefer.init();