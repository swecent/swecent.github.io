(()=>{"use strict";const e=Symbol.for("RemoteUi::Retain"),t=Symbol.for("RemoteUi::Release"),r=Symbol.for("RemoteUi::RetainedBy");class n{constructor(){this.memoryManaged=new Set}add(t){this.memoryManaged.add(t),t[r].add(this),t[e]()}release(){for(const e of this.memoryManaged)e[r].delete(this),e[t]();this.memoryManaged.clear()}}const o="_@f";function a(a){const i=new Map,s=new Map,c=new Map;return{encode:function e(t){if("object"==typeof t){if(null==t)return[t];if(t instanceof ArrayBuffer)return[t];const r=[];if(Array.isArray(t)){return[t.map((t=>{const[n,o=[]]=e(t);return r.push(...o),n})),r]}return[Object.keys(t).reduce(((n,o)=>{const[a,i=[]]=e(t[o]);return r.push(...i),{...n,[o]:a}}),{}),r]}if("function"==typeof t){if(i.has(t)){const e=i.get(t);return[{[o]:e}]}const e=a.uuid();return i.set(t,e),s.set(e,t),[{[o]:e}]}return[t]},decode:l,async call(o,a){const i=new n,c=s.get(o);if(null==c)throw new Error("You attempted to call a function that was already released.");try{const n=(u=c,Boolean(u&&u[e]&&u[t])?[i,...c[r]]:[i]);return await c(...l(a,n))}finally{i.release()}var u},release(e){const t=s.get(e);t&&(s.delete(e),i.delete(t))},terminate(){i.clear(),s.clear(),c.clear()}};function l(n,i){if("object"==typeof n){if(null==n)return n;if(n instanceof ArrayBuffer)return n;if(Array.isArray(n))return n.map((e=>l(e,i)));if(o in n){const o=n["_@f"];if(c.has(o))return c.get(o);let s=0,l=!1;const u=()=>{s-=1,0===s&&(l=!0,c.delete(o),a.release(o))},d=()=>{s+=1},f=new Set(i),m=(...e)=>{if(l)throw new Error("You attempted to call a function that was already released.");if(!c.has(o))throw new Error("You attempted to call a function that was already revoked.");return a.call(o,e)};Object.defineProperties(m,{[t]:{value:u,writable:!1},[e]:{value:d,writable:!1},[r]:{value:f,writable:!1}});for(const e of f)e.add(m);return c.set(o,m),m}return Object.keys(n).reduce(((e,t)=>({...e,[t]:l(n[t],i)})),{})}return n}}function i(){return`${s()}-${s()}-${s()}-${s()}`}function s(){return Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)}const c="0.0.221";class l extends Error{constructor(...e){super(...e),this.name="InsecureUrlError"}}class u extends Error{constructor(...e){super(...e),this.name="InsecureUrlError"}}function d(){const e=XMLHttpRequest.prototype.open;return XMLHttpRequest.prototype.open=function(t,r){const n=new URL(r);if("https:"!==n.protocol)throw new u(`URL must be secure (HTTPS): ${n.href}`);if(n.href.includes(self.location.origin))throw new u(`Request are not allowed to the same origin: ${n.href}`);e.apply(this,arguments)},XMLHttpRequest}function f(e,t,r,n=!0){const o={...n?Object.getOwnPropertyDescriptor(e,t):{},...r};return Object.defineProperty(e,t,o)}const m={Request:!1,Response:!1,Headers:!1,XMLHttpRequest:!1,XMLHttpRequestEventTarget:!1,XMLHttpRequestUpload:!1},p={BarcodeDetector:!0,BroadcastChannel:!0,Cache:!0,CustomEvent:!0,FormData:!0,ImageData:!0,NetworkInformation:!0,ServiceWorkerRegistration:!0,WebSocket:!0,Browser:!0,WorkerBrowser:!0,MessageChannel:!0,MessagePort:!0,crypto:!0,Crypto:!0,CryptoKey:!0,SubtleCrypto:!0,TextDecoder:!0,TextDecoderStream:!0,TextEncoder:!0,TextEncoderStream:!0,Request:!1,Response:!1,Headers:!1,indexedDB:!0,IDBCursor:!0,IDBCursorWithValue:!0,IDBDatabase:!0,IDBFactory:!0,IDBIndex:!0,IDBKeyRange:!0,IDBObjectStore:!0,IDBOpenDBRequest:!0,IDBRequest:!0,IDBTransaction:!0,IDBVersionChangeEvent:!0,Navigator:!0,navigator:!0,Notification:!0,NotificationEvent:!0,EventSource:!0,WebGL2RenderingContext:!0,WebGLActiveInfo:!0,WebGLBuffer:!0,WebGLFramebuffer:!0,WebGLProgram:!0,WebGLQuery:!0,WebGLRenderbuffer:!0,WebGLRenderingContext:!0,WebGLSampler:!0,WebGLShader:!0,WebGLShaderPrecisionFormat:!0,WebGLSync:!0,WebGLTexture:!0,WebGLTransformFeedback:!0,WebGLUniformLocation:!0,WebGLVertexArrayObject:!0,Path2D:!0,Worker:!0,WorkerLocation:!0,WorkerNavigator:!0,ServiceWorker:!0,ServiceWorkerContainer:!0,XMLHttpRequest:!0,XMLHttpRequestEventTarget:!0,XMLHttpRequestUpload:!0,ArrayBuffer:!1,Uint8Array:!0,Int8Array:!0,Uint16Array:!0,Int16Array:!0,Uint32Array:!0,Int32Array:!0,Float32Array:!0,Float64Array:!0,Uint8ClampedArray:!0,BigUint64Array:!0,BigInt64Array:!0,DataView:!0,PushSubscriptionOptions:!0,PushSubscription:!0,PushManager:!0,Permissions:!0,PermissionStatus:!0,PeriodicSyncManager:!0,PaymentInstruments:!0,NavigatorUAData:!0,BackgroundFetchRegistration:!0,BackgroundFetchRecord:!0,BackgroundFetchManager:!0,WritableStreamDefaultWriter:!0,WritableStreamDefaultController:!0,WritableStream:!0,ReadableStreamDefaultReader:!0,ReadableStreamDefaultController:!0,ReadableStreamBYOBRequest:!0,ReadableStreamBYOBReader:!0,ReadableStream:!0,ReadableByteStreamController:!0,RTCEncodedVideoFrame:!0,RTCEncodedAudioFrame:!0,RTCDataChannel:!0,RTCTransformEvent:!0,RTCRtpScriptTransformer:!0,OffscreenCanvasRenderingContext2D:!0,OffscreenCanvas:!0,FontFace:!0,FontFaceSet:!0,FileReaderSync:!0,FileReader:!0,FileList:!0,File:!0,FileSystemDirectoryHandle:!0,FileSystemFileHandle:!0,FileSystemHandle:!0,FileSystemWritableFileStream:!0,FileSystemSyncAccessHandle:!0,webkitRequestFileSystem:!0,webkitRequestFileSystemSync:!0,webkitResolveLocalFileSystemSyncURL:!0,webkitResolveLocalFileSystemURL:!0,DOMStringList:!0,DOMRectReadOnly:!0,DOMRect:!0,DOMQuad:!0,DOMPointReadOnly:!0,DOMPoint:!0,DOMMatrixReadOnly:!0,DOMMatrix:!0,DOMException:!0,CompressionStream:!0,Atomics:!0,WebAssembly:!0,AudioData:!0,EncodedAudioChunk:!0,EncodedVideoChunk:!0,ImageTrack:!0,ImageTrackList:!0,VideoColorSpace:!0,VideoFrame:!0,AudioDecoder:!0,AudioEncoder:!0,ImageDecoder:!0,VideoDecoder:!0,VideoEncoder:!0,AudioTrackConfiguration:!0,VideoTrackConfiguration:!0,Lock:!0,LockManager:!0,WebTransport:!0,WebTransportBidirectionalStream:!0,WebTransportDatagramDuplexStream:!0,WebTransportError:!0,Serial:!0,SerialPort:!0,USB:!0,USBAlternateInterface:!0,USBConfiguration:!0,USBConnectionEvent:!0,USBDevice:!0,USBEndpoint:!0,USBInTransferResult:!0,USBInterface:!0,USBIsochronousInTransferPacket:!0,USBIsochronousInTransferResult:!0,USBIsochronousOutTransferPacket:!0,USBIsochronousOutTransferResult:!0,USBOutTransferResult:!0};function g(e,t){let r=e;do{Object.getOwnPropertyNames(r).filter((e=>e in t&&!1!==t[e])).forEach((e=>{try{let n;"object"==typeof t[e]?(n=r[e],g(n,t[e])):n=!0===t[e]?void 0:t[e],f(r,e,{value:n,configurable:!1,enumerable:!1,writable:!1},!1)}catch(n){}})),r=Object.getPrototypeOf(r)}while(r!==Object.prototype)}function y(e,t=self){var r;g(t,{...e?p:m,fetch:(r=t.fetch,(e,t)=>{const n=e instanceof Request?e:new Request(e),o=new URL(n.url);if("https:"!==o.protocol)throw new l(`URL must be secure (HTTPS): ${o.href}`);if(o.href.includes(self.location.origin)&&!o.href.match(/\/\.well-known\/shopify\/monorail\/unstable\/produce_batch/))throw new l(`Request are not allowed to the same origin: ${o.href}`);return r(n,{...t})}),XMLHttpRequest:d()})}function b(e){let t=e;return{update:async function(e,r){try{t=r(),t=await e()}catch(n){console.error(n)}return t},getRemote:async function(e){try{t=await e()}catch(r){console.error(r)}return t},getValue:()=>t}}function h(e,t,r){const n=b(""),o={get:function(){return n.getRemote(e),n.getValue()},set:function(e){const o=e.split(";").map((e=>e.trim())).find((e=>e.startsWith("domain="))),a=(null==o?void 0:o.split("=")[1])||"";if(!(r.filter((e=>new RegExp(`^\\.?${e}$`).test(a))).length>0)){const r=n.getValue();n.update((()=>t(e)),(()=>function(e,t){const r=e.split("; ").reduce(((e,t)=>{const[r,n]=t.split("=");return n&&(e[r]=n),e}),{}),n=t.split(";")[0],[o,a]=n.split("=");return r[o]=a,Object.entries(r).map((([e,t])=>`${e}=${t}`)).join("; ")}(r,e)))}},configurable:!1,enumerable:!1};return f(document,"cookie",o),{cache:n,definition:o,initialize:()=>n.getRemote(e)}}function w(e){const t=b(""),r={get:function(){return t.getRemote(e),t.getValue()},configurable:!1,enumerable:!1,writeable:!1};return f(window,"origin",r),{cache:t,definition:r,initialize:()=>t.getRemote(e)}}function S(e){const t=b(""),r={get:()=>(t.getRemote(e),t.getValue()),configurable:!1,enumerable:!1,writeable:!1};return f(document,"referrer",r),{cache:t,definition:r,initialize:()=>t.getRemote(e)}}function R(e,t,r){const n=function(e){const t=new Map,r={initialize:async()=>{const r=await e.length()||0;for(let n=0;n<r;n++){const r=await e.key(n)||"",o=await e.getItem(r);o&&t.set(r,o)}},getItem:e=>t.get(e)||null,setItem(r,n){e.setItem(r,n),t.set(r,n)},removeItem(r){e.removeItem(r),t.delete(r)},clear(){e.clear(),t.clear()},get length(){return t.size},key(e){const r=[...t.keys()],[n]=r.filter(((t,r)=>r===e));return n||null}};return r}(r),o={get:()=>n,configurable:!1,enumerable:!1,writeable:!1};return f(e,t,o),{definition:o,initialize:async()=>{await n.initialize()}}}function v(e){return R(window,"localStorage",e.localStorage)}function x(e){return R(window,"sessionStorage",e.sessionStorage)}class k extends Error{constructor(...e){super(...e),Error.captureStackTrace&&Error.captureStackTrace(this,k)}}const E=(e,t)=>{var r,n;if(null!=t&&null!==(r=t.options)&&void 0!==r&&r.sampleRate&&!function(e){if(e<=0||e>100)throw new Error("Invalid sampling percent");return 100*Math.random()<=e}(t.options.sampleRate))return;const o={severity:"error",context:"",unhandled:!0,...t};let a="";const i={lineNumber:"1",columnNumber:"1",method:o.context,file:"browser.js"};if(e.stackTrace||e.stack||e.description){a=e.stack.split("\n")[0];const t=e.stack.match(/([0-9]+):([0-9]+)/);if(t&&t.length>2&&(i.lineNumber=t[1],i.columnNumber=t[2],parseInt(i.lineNumber,10)>1e5))return}fetch("https://notify.bugsnag.com",{method:"POST",headers:{"Content-Type":"application/json","Bugsnag-Api-Key":"bcbc9f6762da195561967577c2d74ff8","Bugsnag-Payload-Version":"5"},body:JSON.stringify({payloadVersion:5,notifier:{name:"web-pixel-manager",version:c,url:"-"},events:[{exceptions:[{errorClass:a,message:a,stacktrace:[i],type:"browserjs"}],context:o.context,severity:o.severity,unhandled:o.unhandled,app:{version:c},metaData:{device:{userAgent:null===(n=self.navigator)||void 0===n?void 0:n.userAgent},request:{shopId:o.shopId,shopUrl:self.location.href,pixelId:o.pixelId,pixelType:o.pixelType,runtimeContext:o.runtimeContext},"Additional Notes":{initConfig:JSON.stringify(o.initConfig),notes:o.notes}}}]})}).catch((()=>{}))};class I extends Error{constructor(...e){super(...e),this.message="Invalid Extension Point"}}function B(){return void 0===self.document&&self instanceof DedicatedWorkerGlobalScope}const M=function(){const e=function(e,{uuid:t=i,createEncoder:r=a,callable:o}={}){let s=!1,c=e;const l=new Map,u=new Map,d=function(e,t){let r;if(null==t){if("function"!=typeof Proxy)throw new Error("You must pass an array of callable methods in environments without Proxies.");const t=new Map;r=new Proxy({},{get(r,n){if(t.has(n))return t.get(n);const o=e(n);return t.set(n,o),o}})}else{r={};for(const n of t)Object.defineProperty(r,n,{value:e(n),writable:!1,configurable:!0,enumerable:!0})}return r}(g,o),f=r({uuid:t,release(e){m(3,[e])},call(e,r,n){const o=t(),a=y(o,n),[i,s]=f.encode(r);return m(5,[o,e,i],s),a}});return c.addEventListener("message",p),{call:d,replace(e){const t=c;c=e,t.removeEventListener("message",p),e.addEventListener("message",p)},expose(e){for(const t of Object.keys(e)){const r=e[t];"function"==typeof r?l.set(t,r):l.delete(t)}},callable(...e){if(null!=o)for(const t of e)Object.defineProperty(d,t,{value:g(t),writable:!1,configurable:!0,enumerable:!0})},terminate(){m(2,void 0),b(),c.terminate&&c.terminate()}};function m(e,t,r){s||c.postMessage(t?[e,t]:[e],r)}async function p(e){const{data:t}=e;if(null!=t&&Array.isArray(t))switch(t[0]){case 2:b();break;case 0:{const e=new n,[o,a,i]=t[1],s=l.get(a);try{if(null==s)throw new Error(`No '${a}' method is exposed on this endpoint`);const[t,r]=f.encode(await s(...f.decode(i,[e])));m(1,[o,void 0,t],r)}catch(r){const{name:e,message:t,stack:n}=r;throw m(1,[o,{name:e,message:t,stack:n}]),r}finally{e.release()}break}case 1:{const[e]=t[1];u.get(e)(...t[1]),u.delete(e);break}case 3:{const[e]=t[1];f.release(e);break}case 6:{const[e]=t[1];u.get(e)(...t[1]),u.delete(e);break}case 5:{const[e,n,o]=t[1];try{const t=await f.call(n,o),[r,a]=f.encode(t);m(6,[e,void 0,r],a)}catch(r){const{name:t,message:n,stack:o}=r;throw m(6,[e,{name:t,message:n,stack:o}]),r}break}}}function g(e){return(...r)=>{if(s)return Promise.reject(new Error("You attempted to call a function on a terminated web worker."));if("string"!=typeof e&&"number"!=typeof e)return Promise.reject(new Error(`Can’t call a symbol method on a remote endpoint: ${e.toString()}`));const n=t(),o=y(n),[a,i]=f.encode(r);return m(0,[n,e,a],i),o}}function y(e,t){return new Promise(((r,n)=>{u.set(e,((e,o,a)=>{if(null==o)r(a&&f.decode(a,t));else{const e=new Error;Object.assign(e,o),n(e)}}))}))}function b(){var e;s=!0,l.clear(),u.clear(),null===(e=f.terminate)||void 0===e||e.call(f),c.removeEventListener("message",p)}}(B()?self:function({targetOrigin:e="*"}={}){if("undefined"==typeof self||null==self.parent)throw new Error("This does not appear to be a child iframe, because there is no parent window.");const{parent:t}=self,r=()=>t.postMessage("remote-ui::ready",e);"complete"===document.readyState?r():document.addEventListener("readystatechange",(()=>{"complete"===document.readyState&&r()}));const n=new WeakMap;return{postMessage(r,n){t.postMessage(r,e,n)},addEventListener(e,r){const o=e=>{e.source===t&&r(e)};n.set(r,o),self.addEventListener(e,o)},removeEventListener(e,t){const r=n.get(t);null!=r&&(n.delete(t),self.removeEventListener(e,r))}}}(),{callable:["pixelRuntimeAPI","sandboxInternalAPI"]}),t=new Set;return e.expose({initialize:async function(r,n,o){const[a,i]=await Promise.all([e.call.pixelRuntimeAPI(),e.call.sandboxInternalAPI()]),s=B();if(y(s),!s){const e=await i.cookieRestrictedDomains();await function(e,t,r){const n=[h(e.cookie.get,e.cookie.set,r).initialize(),w(t.self.origin.get).initialize(),S(t.document.referrer.get).initialize(),v(e).initialize(),x(e).initialize()];return Promise.allSettled?Promise.allSettled(n):Promise.all(n)}(a.browser,i,e),self.document.title=r}return Object.defineProperty(self,"webPixelsManager",{value:{createShopifyExtend:()=>({extend:async(e,r)=>{if("WebPixel::Render"!==e)throw new I;const n=()=>{try{r.call(a,a),i.monorail.register({status:"registered"})}catch(e){const t=o.type,r=o.runtimeContext;throw E(e,{pixelId:o.id,pixelType:t,runtimeContext:r,context:`${t} pixel in ${r} environment`,options:{sampleRate:1}}),i.monorail.register({status:"failed",errorMsg:null==e?void 0:e.message}),e}};await i.userCanBeTracked()?n():t.add(n)}})},enumerable:!0,writable:!1}),(c=n,new Promise(((e,t)=>{if(B())try{self.importScripts(c),e(!0)}catch(r){t(r)}else{const r=document.createElement("script");r.setAttribute("src",c),r.setAttribute("async","async"),r.onload=()=>{e(!0)},r.onerror=e=>{t(e)},document.getElementsByTagName("head")[0].appendChild(r)}}))).catch((e=>{const t=o.type,r=o.runtimeContext;throw E(e,{pixelId:o.id,pixelType:t,runtimeContext:r,context:`${t} pixel in ${r} environment`}),i.monorail.register({status:"failed",errorMsg:null==e?void 0:e.message}),e})),!0;var c},initWebPixelsAwaitingConsent:function(){t.forEach((e=>{t.delete(e),e()}))}}),{endpoint:e}}();self.webPixelsManagerSandbox=M})();